<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Maintenance Calorie Calculator</title>
  <style>
    /* Playful, light, and colorful palette */
    :root{
      --bg:#f1f8ff;
      --card:#ffffff;
      --accent:#ffb84c;
      --accent2:#4cc9f0;
      --muted:#425466;
      --shadow: 0 6px 20px rgba(102,102,102,0.1);
      font-family: 'Poppins', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
    }
    *{box-sizing:border-box}
    body{background:linear-gradient(180deg,var(--bg),#dff7ff);margin:0;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:32px}
    .card{width:100%;max-width:720px;background:var(--card);border-radius:18px;padding:32px;box-shadow:var(--shadow);border-top:6px solid var(--accent2);}
    h1{margin:0;font-size:24px;color:#0d1b2a;text-align:center}
    p.lead{margin:8px 0 22px;color:var(--muted);font-size:14px;text-align:center}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
    label{font-size:13px;color:#334155;display:block;margin-bottom:6px;font-weight:500}
    input[type=number], select, input[type=email]{width:100%;padding:12px;border-radius:10px;border:1px solid #d0e0eb;font-size:14px;background:linear-gradient(180deg,#ffffff,#f8fdff)}
    input[type=number]::-webkit-outer-spin-button,input[type=number]::-webkit-inner-spin-button{ -webkit-appearance:none;margin:0}
    input[type=number]{-moz-appearance:textfield}
    .full{grid-column:1/-1}
    .btn{display:inline-block;padding:12px 18px;border-radius:12px;background:var(--accent);color:#3a2a00;font-weight:600;border:none;cursor:pointer;box-shadow:0 6px 14px rgba(255,184,76,0.25);transition:transform 0.15s ease, background 0.3s ease}
    .btn:hover{transform:translateY(-2px);background:#ffc566}
    .btn:active{transform:scale(0.97)}
    .result{margin-top:22px;padding:16px;border-radius:12px;background:linear-gradient(180deg,#fff9ef,#ffffff);border:1px solid #ffe5b4;font-weight:600;color:#2d1d00;text-align:center;opacity:0;transform:translateY(10px);transition:all 0.4s ease}
    .result.show{opacity:1;transform:translateY(0)}
    footer{margin-top:18px;font-size:12px;color:#546c7c;text-align:center}
    /* modal */
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.35);display:flex;align-items:center;justify-content:center;z-index:40}
    .modal{width:100%;max-width:420px;background:#ffffff;padding:22px;border-radius:14px;box-shadow:0 12px 40px rgba(2,6,8,0.25);animation:pop 0.3s ease}
    .modal h3{margin:0 0 10px;color:#0f172a}
    .modal p{margin:0 0 16px;color:#475569}
    .small-muted{font-size:12px;color:#64748b}
    .hidden{display:none}

    @keyframes pop {
      0% {transform:scale(0.9);opacity:0;}
      100% {transform:scale(1);opacity:1;}
    }
  </style>
</head>
<body>
  <div class="card" role="main">
    <h1>Maintenance calorie calculator</h1>
    <p class="lead">Quick estimate — enter your details and press Calculate.</p>

    <div class="grid">
      <div>
        <label for="weight">Weight (kg)</label>
        <input id="weight" type="number" inputmode="decimal" min="20" max="400" placeholder="e.g. 78">
      </div>

      <div>
        <label for="height">Height (cm)</label>
        <input id="height" type="number" inputmode="numeric" min="90" max="260" placeholder="e.g. 182">
      </div>

      <div>
        <label for="age">Age</label>
        <input id="age" type="number" min="10" max="100" placeholder="e.g. 29">
      </div>

      <div>
        <label for="sex">Sex</label>
        <select id="sex" aria-label="sex">
          <option value="male">Male</option>
          <option value="female">Female</option>
        </select>
      </div>

      <div class="full">
        <label for="activity">Activity level</label>
        <select id="activity">
          <option value="1.2">Sedentary — little or no exercise</option>
          <option value="1.375">Light — 1–3 days / week</option>
          <option value="1.55" selected>Moderate — 3–5 days / week</option>
          <option value="1.725">Active — 6–7 days / week</option>
          <option value="1.9">Very active — hard exercise / physical job</option>
        </select>
      </div>

      <div class="full" style="display:flex;justify-content:flex-end;margin-top:8px">
        <button id="calc" class="btn">Calculate</button>
      </div>
    </div>

    <div id="resultArea" class="result hidden" aria-live="polite"></div>

    <footer>
      <div>Estimate uses Mifflin–St Jeor equation (trusted and precise).</div>
    </footer>
  </div>

  <!-- modal for email capture -->
  <div id="modalBackdrop" class="modal-backdrop hidden" role="dialog" aria-modal="true">
    <div class="modal">
      <h3>Almost there — enter your email</h3>
      <p>Enter your email to view your personalised results. Your data is safe with us.</p>
      <input id="emailInput" type="email" placeholder="you@example.com">
      <div style="height:14px"></div>
      <div style="display:flex;gap:8px;justify-content:flex-end">
        <button id="viewBtn" class="btn">View results</button>
      </div>
      <p class="small-muted" style="margin-top:12px">We will not use this email anywhere else. Your privacy is protected.</p>
    </div>
  </div>

  <script>
    const POST_URL = 'PASTE_YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE';
    const $ = id => document.getElementById(id);
    const calcBtn = $('calc');
    const modal = $('modalBackdrop');
    const viewBtn = $('viewBtn');
    const resultArea = $('resultArea');

    function calcMaintenance({weight, height, age, sex, activity}){
      const s = sex === 'male' ? 5 : -161;
      const bmr = (10 * weight) + (6.25 * height) - (5 * age) + s;
      const maintenance = Math.round(bmr * activity);
      return {bmr: Math.round(bmr), maintenance};
    }

    function showModal(){ modal.classList.remove('hidden'); }
    function hideModal(){ modal.classList.add('hidden'); }

    calcBtn.addEventListener('click', ()=>{
      const weight = parseFloat($('weight').value);
      const height = parseFloat($('height').value);
      const age = parseInt($('age').value,10);
      const sex = $('sex').value;
      const activity = parseFloat($('activity').value);

      if (!weight || !height || !age){
        resultArea.classList.remove('hidden');
        resultArea.classList.add('show');
        resultArea.textContent = 'Fill weight, height and age to continue.';
        return;
      }
      window.pendingInput = {weight,height,age,sex,activity};
      showModal();
    });

    viewBtn.addEventListener('click', async ()=>{
      const email = $('emailInput').value.trim();
      if (!email || !/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(email)){
        alert('Please enter a valid email');
        return;
      }
      hideModal();
      const {weight,height,age,sex,activity} = window.pendingInput;
      const {bmr, maintenance} = calcMaintenance({weight,height,age,sex,activity});
      resultArea.classList.remove('hidden');
      setTimeout(()=> resultArea.classList.add('show'), 50);
      resultArea.innerHTML = `Maintenance calories: <strong>${maintenance.toLocaleString()}</strong> kcal/day<br><span style="font-size:13px;color:#64748b">BMR ~ ${bmr} kcal/day</span>`;
      try{
        if (POST_URL && !POST_URL.includes('PASTE_YOUR')){
          await fetch(POST_URL, {
            method:'POST',
            headers: {'Content-Type':'application/json'},
            body: JSON.stringify({email,weight,height,age,sex,activity,bmr,maintenance,timestamp:new Date().toISOString()})
          });
        } else {
          console.warn('No POST_URL configured.');
        }
      }catch(e){
        console.warn('Failed to send data',e);
      }
      window.pendingInput = null;
      $('emailInput').value = '';
    });
  </script>
</body>
</html>
